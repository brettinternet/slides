---
version: "3"

env:
  HUGO_BUILD_VERSION: dev
  HUGO_BUILD_TIME:
    sh: |
      date -u +"%Y-%m-%dT%H:%M:%SZ"

includes:
  lint: .taskfiles/lint.yaml
  precommit: .taskfiles/precommit.yaml
  setup: .taskfiles/setup.yaml

tasks:
  default:
    silent: true
    cmd: task -l

  init:
    desc: Install dependencies and setup environment
    cmds:
      - task: setup:init
      - task: precommit:init
      - task: precommit:update
      - task: node-modules-install
      - task: update-theme

  start:
    desc: Run development server
    cmd: hugo server --navigateToChanged

  start-drafts:
    desc: Run development server
    cmd: hugo server --navigateToChanged --buildDrafts

  start-full:
    desc: Run development server with full rebuilds (better for CSS changes)
    cmd: hugo server --navigateToChanged --disableFastRender

  build:
    desc: Build production static site
    cmd: hugo

  kill:
    desc: Kill process running on client dev ÃŸport
    cmd: lsof -t -i tcp:1313 | xargs kill

  check:
    desc: Run client checks
    cmd: bun run check

  fix:
    desc: Fix client checks
    cmds:
      - bun run fix
      - hugo mod tidy

  node-modules-install:
    cmd: bun install
    status:
      - test -d node_modules

  update-theme:
    desc: Update git submodules
    cmds:
      - git submodule update --init --recursive
      - git submodule foreach git pull origin master
